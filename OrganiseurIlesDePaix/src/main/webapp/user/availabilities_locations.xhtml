<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            Modifier ses disponibilités
        </ui:define>
        <ui:define name="head">
            <script src="https://maps.google.com/maps/api/js?sensor=false"/>
        </ui:define>
        <ui:define name="body">
            <h2>Emplacements</h2>
            <p:outputPanel styleClass="infoTip">
                <p>Choisissez les emplacements où vous pourrez vous rendre.</p>
            </p:outputPanel>
            <h:panelGrid columns="2" columnClasses="locationsLeftCol, locationsRightCol"
                         style="width: 100%; min-height: 50vh;">
                <p:outputPanel id="listColumn">
                    <p:panel header="Recherche" collapsed="false" toggleable="true">
                        <h:form id="searchLocationForm">
                            <h:panelGrid columns="2">
                                <h:outputLabel value="Nom:" />
                                <p:inputText value="#{registerAvailabilitiesController.locationSearch.nameLike}"/>
                                <h:outputLabel value="Ville:" />
                                <p:inputText value="#{registerAvailabilitiesController.locationSearch.cityLike}"/>
                                <h:outputLabel value="Code postal:" />
                                <p:inputText value="#{registerAvailabilitiesController.locationSearch.postalCode}"/>
                            </h:panelGrid>
                            <p:commandButton value="Rechercher"
                                             action="#{registerAvailabilitiesController.actionSearchLocations()}"
                                             update=":listLocationForm"/>
                        </h:form>
                    </p:panel>
                    <h:form id="listLocationForm">
                        <p:dataList value="#{registerAvailabilitiesController.locationsModel}"
                                    var="location"
                                    lazy="true"
                                    rows="20"
                                    type="definition">
                            <h:panelGrid columns="2" columnClasses="locationItemCol, locationItemActionCol"
                                         styleClass="locationItemTable">
                                <p:outputPanel styleClass="locationListItem">
                                    <h3>#{location.name}</h3>
                                    <p class="address">#{location.address}, #{location.postalCode} #{location.city}</p>
                                    <p class="requiredAmount">#{location.requriedPersonAmount} personne(s) requise(s)</p>
                                </p:outputPanel>
                                <p:outputPanel id='locationListSelectionPanel'
                                               styleClass="locationListSelectionPanel">
                                    <p:commandButton value="Sélectionner"
                                                     rendered="#{not registerAvailabilitiesController.isLocationSelected(location)}"
                                                     action="#{registerAvailabilitiesController.actionSelectLocation(location)}"
                                                     update="locationListSelectionPanel :mapForm:gmap :availabilitiesLinksForm"/>
                                    <p:commandLink value="Annuler"
                                                   rendered="#{registerAvailabilitiesController.isLocationSelected(location)}"
                                                   action="#{registerAvailabilitiesController.actionUnselectLocation(location)}"
                                                   update="locationListSelectionPanel :mapForm:gmap :availabilitiesLinksForm"/>
                                </p:outputPanel>
                            </h:panelGrid>
                        </p:dataList>
                    </h:form>
                </p:outputPanel>
                <h:form id='mapForm' style="display: inline-block; width: 100%; height: 100%;">
                    <p:gmap id="gmap" center="50.671952,4.5678592" zoom="13" 
                            type="HYBRID" model="#{registerAvailabilitiesController.googleMapModel}" style="width: 100%; height: 100%;"
                            fitBounds="true">
                        <p:ajax event="overlaySelect" listener="#{registerAvailabilitiesController.onMarkerSelect}"
                                update=":listLocationForm :mapForm:gmap :availabilitiesLinksForm"/>
                    </p:gmap>

                </h:form>

            </h:panelGrid>
            <h:form id="availabilitiesLinksForm"  styleClass="availabilitiesLinksForm">
                <p:commandButton styleClass="nextButton"
                                 value="Terminer"
                                 disabled="#{not registerAvailabilitiesController.isAnyLocationSelected()}"
                                 action="#{registerAvailabilitiesController.actionRegister()}"/>
                <p:commandButton styleClass="prevButton"
                                 value="Retour"
                                 action="#{registerAvailabilitiesController.actionShowDates()}"/>
            </h:form>
        </ui:define>
    </ui:composition>
</html>

